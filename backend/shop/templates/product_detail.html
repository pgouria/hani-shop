{% extends 'base.html' %} {% load humanize %} {% block content %}

<div class="row mb-3 mt-4">
  <div class="col-md-1"></div>
  <!-- product content -->
  <div class="col-md-5 p-3 border rounded">
    <!-- category -->
    <div class="border-bottom mb-2 pb-2">
      <span class="text-muted">دسته بندی ها:</span
      ><a
        class="text-decoration-none text-dark"
        href="{% url 'shop:filter_by_category' product.category.slug %}"
      >
        {{product.category}}</a
      >
    </div>
    <!-- title -->
    <h2>{{ product.title }}</h2>

    <!-- PRICE DISPLAY -->
    <h4 class="mb-4">
      قیمت:
      <span id="price" class="fw-bold text-success">—</span>
      تومان
    </h4>

    <!-- description -->
    <div class="mt-4 pe-3 mb-5">{{ product.description }}</div>
    <!-- cart btn -->
    <form method="post" action="{% url 'cart:add_to_cart' %}">
      {% csrf_token %}

      <h5 class="mb-3">انتخاب مدل:</h5>

      {% for variant in variants %}
      <div class="form-check mb-2">
        <input
          type="radio"
          name="variant"
          value="{{ variant.id }}"
          class="form-check-input variant-radio"
          data-price="{{ variant.price }}"
          id="variant{{ variant.id }}"
          required
        />
        <label class="form-check-label" for="variant{{ variant.id }}">
          {{ variant.attributes }} — {{ variant.price|intcomma }} تومان
        </label>
      </div>
      {% endfor %} {{ form }}

      <button type="submit" class="btn btn-primary w-100 mt-4">
        افزودن به سبد خرید
      </button>
    </form>

    <br />
    {% if favorites == 'remove' %}
    <a
      href="{% url 'shop:remove_from_favorites' product.id %}"
      class="btn btn-outline-danger mt-5 text-capitalize"
      >{{favorites}} از علاقه مندی ها</a
    >
    {% else %}
    <a
      href="{% url 'shop:add_to_favorites' product.id %}"
      class="btn btn-outline-success mt-5 text-capitalize"
      >اضافه کردن به {{favorites}}</a
    >
    {% endif %}
  </div>
  <!-- product image -->
  <div class="col-md-6">
    <img
      style="object-fit: cover"
      class="rounded"
      src="{{ product.image.url }}"
      width="510"
      height="500"
    />
  </div>
</div>
<!-- related products -->
<div class="row mt-4 mb-4">
  <h3>محصولات مرتبط:</h3>
  <hr />
  {% for p in related_products %}
  <!-- dont show the current product in this page -->
  {% if p != product %}
  <div class="card me-2 mb-2" style="width: 16rem">
    <img
      style="object-fit: cover"
      class="card-img mt-2"
      width="268"
      height="200"
      src="{{ p.image.url }}"
    />
    <div class="mt-3 text-center">
      <h5 class="card-title">{{ p.title }}</h5>
      <p class="text-muted">${{ p.price }}</p>
      <a
        href="{{ p.get_absolute_url }}"
        class="mb-3 btn btn-outline-primary w-100"
        >همین الان بخر!</a
      >
    </div>
  </div>
  {% endif %} {% endfor %}
</div>

<script>
  const priceEl = document.getElementById("price");
  const radios = document.querySelectorAll(".variant-radio");

  function format(n) {
    return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  radios.forEach((radio) => {
    radio.addEventListener("change", () => {
      priceEl.textContent = format(radio.dataset.price);
    });
  });

  // auto select first variant
  if (radios.length) {
    radios[0].checked = true;
    priceEl.textContent = format(radios[0].dataset.price);
  }
</script>

{% endblock %}
